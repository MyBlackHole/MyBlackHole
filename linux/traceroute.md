# traceroute
路由跟踪

traceroute是用来检测发出数据包的主机到目标主机之间所经过的网关数量的工具
traceroute的原理是试图以最小的TTL（存活时间）发出探测包来跟踪数据包到达目标主机所经过的网关，然后监听一个来自网关ICMP的应答
发送数据包的大小默认为38个字节。 

程序利用增加存活时间（TTL）来实现其功能
每当数据包(3个数据包包括源地址，目的地址和包发出的时间标签)经过一个路由器，其存活时间就会减1
当其存活时间是0时，主机便取消数据包，并传送一个ICMP
（Internet控制报文协议.它是TCP/IP协议族的一个子协议，用于在IP主机、路由器之间传递控制消息.控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息.这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用）
TTL数据包给原数据包的发出者

## 过程
首先它发送一份TTL字段为1的IP数据包给目的主机
处理这个数据包的第一个路由器将TTL值减1
然后丢弃该数据报，并给源主机发送一个ICMP报文
（“超时”信息，这个报文包含了路由器的IP地址，这样就得到了第一个路由器的地址）
然后traceroute发送一个TTL为2的数据报来得到第二个路由器的IP地址
继续这个过程，直至这个数据报到达目的主机

## 格式
traceroute [参数] [主机] 

### 功能
traceroute指令让你追踪网络数据包的路由途径，预设数据包大小是40Bytes，用户可另行设置
具体参数格式：traceroute [-dFlnrvx][-f<存活数值>][-g<网关>…][-i<网络界面>][-m<存活数值>][-p<通信端口>][-s<来源地址>][-t<服务类型>][-w<超时秒数>][主机名称或IP地址][数据包大小]

#### 参数
-d 使用Socket层级的排错功能。  
-f 设置第一个检测数据包的存活数值TTL的大小。  
-F 设置勿离断位。  
-g 设置来源路由网关，最多可设置8个。  
-i 使用指定的网络界面送出数据包。  
-I 使用ICMP回应取代UDP资料信息。  
-m 设置检测数据包的最大存活数值TTL的大小。  
-n 直接使用IP地址而非主机名称。  
-p 设置UDP传输协议的通信端口。  
-r 忽略普通的Routing Table，直接将数据包送到远端主机上。  
-s 设置本地主机送出数据包的IP地址。  
-t 设置检测数据包的TOS数值。  
-v 详细显示指令的执行过程。  
-w 设置等待远端主机回报的时间。  
-x 开启或关闭数据包的正确性检验。 


## 例子

-
```shell
traceroute www.baidu.com

traceroute to www.baidu.com (14.119.104.254), 30 hops max, 60 byte packets
 1  * * *
 2  * * *
 3  * * *
 4  * * *
 5  * * *
 6  * * *
 7  * * *
 8  * * *
 9  * * *
10  * * *
11  * * *
12  * * *
13  * * *
14  * * *
15  * * *
16  * * *
17  * * *
18  * * *
19  * * *
20  * * *
21  * * *
22  * * *
23  * * *
24  * * *
25  * * *
26  * * *
27  * * *
28  * * *
29  * * *
30  * * *

记录按序列号从1开始，每个纪录就是一跳 ，每跳表示一个网关，我们看到每行有三个时间，单位是 ms，其实就是-q的默认参数。探测数据包向每个网关发送三个数据包后，网关响应后返回的时间
有时我们traceroute 一台主机时，会看到有一些行是以星号表示的。出现这样的情况，可能是防火墙封掉了ICMP的返回信息，所以我们得不到什么相关的数据包返回数据
```

- 跳数设置
```shell
traceroute -m 10 www.baidu.com
```

- 探测包使用 UDP 端口设置 6888
```shell
traceroute -p 6888 www.baidu.com  
```

- 把对外发探测包的等待响应时间设置为3秒
```shell
traceroute -w 3 www.baidu.com
```
