# count

计算剩余量

```sql
sql = "select * from oceanbase.__all_virtual_server_stat;"
+----------------+----------+-------+-----------+--------------+----------------------+-------------+--------------+----------------------+--------------+---------------+-----------------------+----------+--------------------+----------------+--------------+--------------------+---------------------+--------------------+-------------+----+------------+-------------------------------------------------------------------------------------------+------------------+---------------------+-----------------------+--------------------+-------------------+-----------+----------------------+--------------+------------------+-----------------+----------------+------------+-------------+-----------------+-------------------+-------------------+--------------+------------------+--------------+------------------+----------------------+
| svr_ip         | svr_port | zone  | cpu_total | cpu_assigned | cpu_assigned_percent | mem_total   | mem_assigned | mem_assigned_percent | disk_total   | disk_assigned | disk_assigned_percent | unit_num | migrating_unit_num | merged_version | leader_count | load               | cpu_weight          | memory_weight      | disk_weight | id | inner_port | build_version                                                                             | register_time    | last_heartbeat_time | block_migrate_in_time | start_service_time | last_offline_time | stop_time | force_stop_heartbeat | admin_status | heartbeat_status | with_rootserver | with_partition | mem_in_use | disk_in_use | clock_deviation | heartbeat_latency | clock_sync_status | cpu_capacity | cpu_max_assigned | mem_capacity | mem_max_assigned | ssl_key_expired_time |
+----------------+----------+-------+-----------+--------------+----------------------+-------------+--------------+----------------------+--------------+---------------+-----------------------+----------+--------------------+----------------+--------------+--------------------+---------------------+--------------------+-------------+----+------------+-------------------------------------------------------------------------------------------+------------------+---------------------+-----------------------+--------------------+-------------------+-----------+----------------------+--------------+------------------+-----------------+----------------+------------+-------------+-----------------+-------------------+-------------------+--------------+------------------+--------------+------------------+----------------------+
| 192.168.80.143 | 2882     | zone1 | 12.0      | 7.5          | 62                   | 19327352832 | 15569256448  | 80                   | 320902004736 | 232176293888  | 72                    | 3        | 0                  | 24             | 1436         | 0.7191418071768267 | 0.47859922178988323 | 0.5214007782101168 | 0.0         | 1  | 2881       | 3.2.3.3_107000092023011911-7699b9a5504eec15ff5ef1f2a95e60136802b170(Jan 19 2023 11:29:19) | 0                | 1698311253214311    | 0                     | 1697424882030617   | 0                 | 0         | 0                    | NORMAL       | alive            | 1               | 1              | 0          | 287309824   | -31             | 342               | SYNC              | 12.0         | 12.0             | 19327352832  | 16535624089      | 0                    |
| 192.168.80.144 | 2882     | zone2 | 12.0      | 6.5          | 54                   | 19327352832 | 10200547328  | 52                   | 320902004736 | 231639422976  | 72                    | 2        | 0                  | 24             | 149          | 0.5344249891915261 | 0.47859922178988323 | 0.5214007782101168 | 0.0         | 2  | 2881       | 3.2.3.3_107000092023011911-7699b9a5504eec15ff5ef1f2a95e60136802b170(Jan 19 2023 11:29:19) | 1697426725713672 | 1698311251947031    | 0                     | 1697424881638323   | 0                 | 0         | 0                    | NORMAL       | alive            | 0               | 1              | 0          | 289406976   | -1205           | 918               | SYNC              | 12.0         |  9.0             | 19327352832  | 11166914969      | 0                    |
| 192.168.80.145 | 2882     | zone3 | 12.0      | 6.5          | 54                   | 19327352832 | 10200547328  | 52                   | 320902004736 | 221438875648  | 69                    | 2        | 0                  | 24             | 0            | 0.5344249891915261 | 0.47859922178988323 | 0.5214007782101168 | 0.0         | 3  | 2881       | 3.2.3.3_107000092023011911-7699b9a5504eec15ff5ef1f2a95e60136802b170(Jan 19 2023 11:29:19) | 1697426725713917 | 1698311253466529    | 0                     | 1697424881650543   | 0                 | 0         | 0                    | NORMAL       | alive            | 0               | 1              | 0          | 243269632   | -1200           | 749               | SYNC              | 12.0         |  9.0             | 19327352832  | 11166914969      | 0                    |
+----------------+----------+-------+-----------+--------------+----------------------+-------------+--------------+----------------------+--------------+---------------+-----------------------+----------+--------------------+----------------+--------------+--------------------+---------------------+--------------------+-------------+----+------------+-------------------------------------------------------------------------------------------+------------------+---------------------+-----------------------+--------------------+-------------------+-----------+----------------------+--------------+------------------+-----------------+----------------+------------+-------------+-----------------+-------------------+-------------------+--------------+------------------+--------------+------------------+----------------------+


zone_max_malloc as zmm
    zone_x: (mem_total, disk_total, cpu_total)



sql = "select * from oceanbase.gv$unit;"
"""
+---------+----------------+------------------+------------------+--------------------+-------+-----------+--------------------+----------------+----------+---------------------+-----------------------+---------+---------+------------+------------+----------+----------+---------------+---------------------+
| unit_id | unit_config_id | unit_config_name | resource_pool_id | resource_pool_name | zone  | tenant_id | tenant_name        | svr_ip         | svr_port | migrate_from_svr_ip | migrate_from_svr_port | max_cpu | min_cpu | max_memory | min_memory | max_iops | min_iops | max_disk_size | max_session_num     |
+---------+----------------+------------------+------------------+--------------------+-------+-----------+--------------------+----------------+----------+---------------------+-----------------------+---------+---------+------------+------------+----------+----------+---------------+---------------------+
| 3       | 1              | sys_unit_config  | 1                | sys_pool           | zone3 | 1         | sys                | 192.168.80.145 | 2882     |                     | 0                     | 5.0     | 2.5     | 5798205849 | 4831838208 | 10000    | 5000     | 220902004736  | 9223372036854775807 |
| 2       | 1              | sys_unit_config  | 1                | sys_pool           | zone2 | 1         | sys                | 192.168.80.144 | 2882     |                     | 0                     | 5.0     | 2.5     | 5798205849 | 4831838208 | 10000    | 5000     | 220902004736  | 9223372036854775807 |
| 1       | 1              | sys_unit_config  | 1                | sys_pool           | zone1 | 1         | sys                | 192.168.80.143 | 2882     |                     | 0                     | 5.0     | 2.5     | 5798205849 | 4831838208 | 10000    | 5000     | 220902004736  | 9223372036854775807 |
| 1001    | 1001           | unit1            | 1001             | pool1              | zone1 | 1001      | tenant1_1698215702 | 192.168.80.143 | 2882     |                     | 0                     | 4.0     | 4.0     | 5368709120 | 5368709120 | 128      | 128      | 10737418240   | 64                  |
| 1002    | 1001           | unit1            | 1002             | pool2              | zone2 | 1002      | tenant2_1698215702 | 192.168.80.144 | 2882     |                     | 0                     | 4.0     | 4.0     | 5368709120 | 5368709120 | 128      | 128      | 10737418240   | 64                  |
| 1004    | 1003           | config_pool3_pyq | 1020             | pool_gzz           | zone1 | <null>    | <null>             | 192.168.80.143 | 2882     |                     | 0                     | 3.0     | 1.0     | 5368709120 | 5368709120 | 128      | 128      | 536870912     | 64                  |
| 1003    | 1004           | config_pool3_dac | 1011             | pool_pool3_gzz     | zone3 | <null>    | <null>             | 192.168.80.145 | 2882     |                     | 0                     | 4.0     | 4.0     | 5368709120 | 5368709120 | 128      | 128      | 536870912     | 64                  |
+---------+----------------+------------------+------------------+--------------------+-------+-----------+--------------------+----------------+----------+---------------------+-----------------------+---------+---------+------------+------------+----------+----------+---------------+---------------------+
"""


zone_malloc as zm
    zone_x: group(zone)(sum(max_cpu), sum(max_memory), sum(max_disk_size))



zone_free_malloc
    zone_x: (free_mem: (zmm.zone_x.mem_total - zm.zone_x.max_memory), free_cpu: (zmm.zone_x.cpu_total - zm.zone_x.max_cpu), free_disk: (zmm.zone_x.disk_total - zm.zone_x.max_disk_size))
```
