# restore

- config
```shell
SHOW PARAMETERS LIKE 'backup_dest'\G
```

- 执行恢复
```sql
ALTER SYSTEM SET restore_concurrency = 10;
ALTER SYSTEM RESTORE tenant01_1693208031 FROM tenant1 at "oss://wdg1?host=192.168.78.212&access_id=123&access_key=123" UNTIL "2023-11-02 14:30:43" WITH "backup_cluster_name=wdg80140141142&backup_cluster_id=1675402848&pool_list=pool_2222_sgd"
```

- 查询恢复进度
```sql
SELECT * FROM oceanbase.CDB_OB_RESTORE_PROGRESS;

+--------+-----------------+-----------+---------------------+------------------+--------------------+-------------------+---------------------+------------+---------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+--------------------------+---------------------------+------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+------+
| JOB_ID | EXTERNAL_JOB_ID | TENANT_ID | TENANT_NAME         | BACKUP_TENANT_ID | BACKUP_TENANT_NAME | BACKUP_CLUSTER_ID | BACKUP_CLUSTER_NAME | WHITE_LIST | STATUS              | START_TIME                 | COMPLETION_TIME | PARTITION_COUNT | MACRO_BLOCK_COUNT | FINISH_PARTITION_COUNT | FINISH_MACRO_BLOCK_COUNT | RESTORE_START_TIMESTAMP    | RESTORE_FINISH_TIMESTAMP | RESTORE_CURRENT_TIMESTAMP | BACKUP_SET_LIST                                                                                                                          | BACKUP_PIECE_LIST                                                                                               | INFO |
+--------+-----------------+-----------+---------------------+------------------+--------------------+-------------------+---------------------+------------+---------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+--------------------------+---------------------------+------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+------+
| 1      | -1              | 1005      | tenant01_1693208031 | 1001             | tenant1            | 1675402848        | wdg80140141142      |            | RESTORE_SYS_REPLICA | 2023-11-02 14:54:52.523187 | <null>          | 149             | -1                | 23                     | -1                       | 2023-11-02 14:07:07.221761 | 2023-11-02 14:30:43      | <null>                    | oss://wdg1/wdg80140141142/1675402848/incarnation_1/1001/data/backup_set_4_full_20231102?host=192.168.78.212&access_id=123&access_key=123 | oss://wdg1/wdg80140141142/1675402848/incarnation_1/1001/clog/7?host=192.168.78.212&access_id=123&access_key=123 |      |
+--------+-----------------+-----------+---------------------+------------------+--------------------+-------------------+---------------------+------------+---------------------+----------------------------+-----------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+--------------------------+---------------------------+------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+------+
```

- 查询恢复历史
```sql
SELECT * FROM oceanbase.CDB_OB_RESTORE_HISTORY;

+--------+-----------------+-----------+---------------------+------------------+--------------------+-------------------+---------------------+------------+-----------------+----------------------------+----------------------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+--------------------------+---------------------------+------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+------+
| JOB_ID | EXTERNAL_JOB_ID | TENANT_ID | TENANT_NAME         | BACKUP_TENANT_ID | BACKUP_TENANT_NAME | BACKUP_CLUSTER_ID | BACKUP_CLUSTER_NAME | WHITE_LIST | STATUS          | START_TIME                 | COMPLETION_TIME            | PARTITION_COUNT | MACRO_BLOCK_COUNT | FINISH_PARTITION_COUNT | FINISH_MACRO_BLOCK_COUNT | RESTORE_START_TIMESTAMP    | RESTORE_FINISH_TIMESTAMP | RESTORE_CURRENT_TIMESTAMP | BACKUP_SET_LIST                                                                                                                          | BACKUP_PIECE_LIST                                                                                               | INFO |
+--------+-----------------+-----------+---------------------+------------------+--------------------+-------------------+---------------------+------------+-----------------+----------------------------+----------------------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+--------------------------+---------------------------+------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+------+
| 1      | -1              | 1005      | tenant01_1693208031 | 1001             | tenant1            | 1675402848        | wdg80140141142      |            | RESTORE_SUCCESS | 2023-11-02 14:54:52.523187 | 2023-11-02 14:57:35.413697 | 0               | -1                | 0                      | -1                       | 2023-11-02 14:07:07.221761 | 2023-11-02 14:30:43      | <null>                    | oss://wdg1/wdg80140141142/1675402848/incarnation_1/1001/data/backup_set_4_full_20231102?host=192.168.78.212&access_id=123&access_key=123 | oss://wdg1/wdg80140141142/1675402848/incarnation_1/1001/clog/7?host=192.168.78.212&access_id=123&access_key=123 |      |
+--------+-----------------+-----------+---------------------+------------------+--------------------+-------------------+---------------------+------------+-----------------+----------------------------+----------------------------+-----------------+-------------------+------------------------+--------------------------+----------------------------+--------------------------+---------------------------+------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+------+
```
