# 持久化
reids是一个内存数据库，数据以内存为载体，redis退出后内存会被释放，所以需要对内存持久化
两种：RDB(快照)，AOF(类似日志追加)

- RDB
redis 默认的持久化方式, RDB 保存 redis **某一时刻**的数据的快照
优点
    RDB快照是一个压缩过的非常紧凑的文件，保存着某个时间点的数据集，适合做数据的备份，灾难恢复 
    可以最大化Redis的性能，在保存RDB文件，服务器进程只需fork一个子进程来完成RDB文件的创建，父进程不需要做IO操作 
    与AOF相比，恢复大数据集的时候会更快 
缺点
    RDB的数据安全性是不如AOF的，保存整个数据集的过程是比繁重的，根据配置可能要几分钟才快照一次，如果服务器宕机，那么就可能丢失几分钟的数据 
    Redis数据集较大时，fork的子进程要完成快照会比较耗CPU、耗时 

```shell
# # 配置
# 时间策略
save 900 1  # save 900 1 表示900s内如果有1条是写入命令，就触发产生一次快照，可以理解为就进行一次备份
save 300 10  #  表示300s内有10条写入，就产生快照
save 60 10000

# 文件名称
dbfilename dump.rdb

# 文件保存路径
dir /home/work/app/redis/data/

# 如果持久化出错，主进程是否停止写入
stop-writes-on-bgsave-error yes

# 是否压缩
rdbcompression yes

# 导入时是否检查
rdbchecksum yes
```

- AOF
优点
    数据更完整，安全性更高，秒级数据丢失（取决fsync策略，如果是everysec，最多丢失1秒的数据） 
    AOF文件是一个只进行追加的日志文件，且写入操作是以Redis协议的格式保存的，内容是可读的，适合误删紧急恢复 
缺点
    对于相同的数据集，AOF文件的体积要大于RDB文件，数据恢复也会比较慢 
    根据所使用的 fsync 策略，AOF 的速度可能会慢于 RDB。 不过在一般情况下， 每秒 fsync 的性能依然非常高 

| Column1    | RDB    | AOF          |
| ---------- | ------ | ------------ |
| 启动优先级 | 低     | 高           |
| 体积       | 小     | 大           |
| 恢复速度   | 快     | 慢           |
| 数据安全性 | 丢数据 | 根据策略决定 |
