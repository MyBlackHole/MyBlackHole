# core

[[ulimit]]

- core 文件生成
```shell
cat /proc/sys/kernel/core_pattern
/sbin/sysctl kernel.core_pattern

<!-- 临时修改 -->
echo "core-%p-%e" > /proc/sys/kernel/core_pattern
生成 core 文件名为: core-pid-程序文件名

<!-- 永久修改 -->
使用 sysctl -w name=value 命令
/sbin/sysctl -w kernel.core_pattern=core-%p-%e
```

## 例子

- observer Segmentation fault

Missing separate debuginfo for the main executable file
Try: yum --enablerepo='*debug*' install /usr/lib/debug/.build-id/a5/ac0d7d7b95fb983bca07b16e382c07
Core was generated by `/home/admin/oceanbase/bin/observer'.
Program terminated with signal 11, Segmentation fault.
#0  0x00007fcc36fd24fb in ?? ()
"/data/1/core-DAG_TYPE_BACKUP-2112-1697074277" is a core file.
Please specify an executable to debug.
```shell
gdb core-DAG_TYPE_BACKUP-2112-1697074277

<!-- 载入二进制程序 -->
<!-- 用于关联显示未值地址的符号信息 -->
file /home/admin/oceanbase/bin/observer

set solib-search-path /lib64

set height 0
<!-- 设置记录文件 -->
set logging file thread_info.txt
<!-- 开启记录 -->
set logging on
<!-- bt，查看当前线程的栈信息 -->
<!-- 打印所有线程栈 -->
thread apply all bt
<!-- 关闭记录 -->
set logging off

#0  0x00007f7334f624fb in raise () from /usr/lib64/libpthread.so.0
#1  0x000000000f830b5a in oceanbase::common::coredump_cb(int, siginfo_t*) ()
#2  <signal handler called>
#3  0x00000000109a1ed0 in oss_list_objects_content_parse ()
#4  0x00000000109a2041 in oss_list_objects_contents_parse ()
#5  0x00000000109a22ed in oss_list_objects_parse_from_body ()
#6  0x0000000010995664 in oss_list_object ()
#7  0x000000000f5190c4 in oceanbase::common::ObStorageOssUtil::list_files(oceanbase::common::ObString const&, oceanbase::common::ObString const&, oceanbase::common::ObIAllocator&, oceanbase::common::ObIArray<oceanbase::common::ObString>&) ()
#8  0x000000000f4e499e in oceanbase::common::ObStorageUtil::list_files(oceanbase::common::ObString const&, oceanbase::common::ObString const&, oceanbase::common::ObIAllocator&, oceanbase::common::ObIArray<oceanbase::common::ObString>&) ()
#9  0x00000000056af0a7 in oceanbase::share::ObEsiUtil::list_files(oceanbase::common::ObString const&, oceanbase::common::ObString const&, oceanbase::common::ObIAllocator&, oceanbase::common::ObIArray<oceanbase::common::ObString>&) ()
#10 0x000000000a7b8d4f in oceanbase::storage::ObRestoreFileUtil::fetch_max_backup_file_id(oceanbase::common::ObString const&, oceanbase::common::ObString const&, long const&, long&, long&) ()
#11 0x000000000a7b4b53 in oceanbase::storage::ObBackupPhysicalPGCtx::init_already_backup_data() ()
#12 0x000000000a7905ad in oceanbase::storage::ObBackupPhysicalPGCtx::open(oceanbase::common::ObInOutBandwidthThrottle&, oceanbase::share::ObPhysicalBackupArg const&, oceanbase::common::ObPartitionKey const&, oceanbase::share::ObBackupDataType const&) ()
#13 0x000000000a78f7d9 in oceanbase::storage::ObBackupPrepareTask::build_backup_physical_ctx(oceanbase::storage::ObBackupPhysicalPGCtx&) ()
#14 0x000000000a78f026 in oceanbase::storage::ObBackupPrepareTask::generate_backup_sstable_copy_task(oceanbase::share::ObITask*, oceanbase::share::ObITask*) ()
#15 0x000000000a78ea82 in oceanbase::storage::ObBackupPrepareTask::generate_backup_sstable_tasks(oceanbase::share::ObITask*&) ()
#16 0x000000000a78e809 in oceanbase::storage::ObBackupPrepareTask::generate_backup_tasks(oceanbase::share::ObFakeTask&) ()
#17 0x000000000a78e23a in oceanbase::storage::ObBackupPrepareTask::generate_backup_tasks(oceanbase::share::ObITask*&) ()
#18 0x000000000a78d672 in oceanbase::storage::ObBackupPrepareTask::generate_pg_backup_tasks(oceanbase::common::ObIArray<oceanbase::share::ObITask*>&) ()
#19 0x000000000a789091 in oceanbase::storage::ObBackupPrepareTask::schedule_backup_tasks() ()
#20 0x000000000a78876a in oceanbase::storage::ObBackupPrepareTask::process() ()
#21 0x00000000069d4e57 in oceanbase::share::ObITask::do_work() ()
#22 0x00000000052fb3a4 in oceanbase::share::ObDagWorker::run1() ()
#23 0x000000000679a3ee in oceanbase::lib::ThreadPool::run0() ()
#24 0x000000000f5b9993 in std::_Function_handler<void (), oceanbase::lib::UserThread::start()::$_14::operator()(oblib::Thread*) const::{lambda()#1}>::_M_invoke(std::_Any_data const&) ()
#25 0x000000000f5b97ef in eeentry(boost::context::detail::transfer_t) ()
#26 0x000000000f858abf in make_fcontext ()
#27 0x0000000000000000 in ?? ()
```
